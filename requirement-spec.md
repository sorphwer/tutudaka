# Tutudaka - 习惯打卡日历 📅

## 1. 项目概述

**Tutudaka** 是一个轻量级的习惯打卡日历应用，帮助用户追踪每日的生活习惯。

| 属性 | 说明 |
|------|------|
| 技术栈 | Next.js + TypeScript |
| 部署平台 | Vercel |
| 目标设备 | 仅移动端（竖屏 UI） |
| 语言 | 中文 |
| 主题 | 支持明/暗主题（跟随系统） |

---

## 2. 功能需求

### 2.1 页面布局

```
┌─────────────────────────┐
│      < 2025年1月 >      │  ← 月份标题 + 左右切换箭头
├─────────────────────────┤
│                         │
│                         │
│      📅 月历视图         │  ← 上方 3/4 区域
│   (每天四角显示彩色线条图标) │
│                         │
│                         │
├─────────────────────────┤
│   [Sun] 早起    [Moon] 早睡     │  
│   [Bag] 点外卖  [Fork] 出去吃    │  ← 下方 1/4 区域：任务清单 (使用 Lucide 图标)
└─────────────────────────┘
```

### 2.2 四个习惯任务

| 任务 | 类型 | 颜色 | Lucide 图标 |
|------|------|------|-------------|
| 早起 | ✅ 正向（鼓励） | 可爱绿色 🟢 (#6BCB77) | `Sun` |
| 早睡 | ✅ 正向（鼓励） | 可爱绿色 🟢 (#6BCB77) | `Moon` |
| 点外卖 | ❌ 负向（避免） | 可爱红色 🔴 (#FF6B6B) | `ShoppingBag` |
| 出去吃 | ❌ 负向（避免） | 可爱红色 🔴 (#FF6B6B) | `Utensils` |

**图标库**：使用 `lucide-react`

### 2.3 月历视图

- 类似 iPhone 日历月视图风格，但更可爱
- 每个日期格子显示：
  - 日期数字（居中）
  - **四角彩色 Lucide 线条图标**表示任务完成情况：
    ```
        ☀️      🌙        ← 左上：早起 (绿色)  右上：早睡 (绿色)
           [ 15 ]
        🛍️      🍴        ← 左下：点外卖 (红色)  右下：出去吃 (红色)
    ```
  - 使用 Lucide 图标的彩色线条样式
  - 图标尺寸：12x12px，线条宽度 2.5
  - 图标只在任务**已完成时显示**，未完成不显示
  - 当天日期有特殊高亮样式（24px 红色圆形背景，`h-6 w-6`）
  - 被选中的日期有选中态样式（蓝色边框 + 浅蓝背景）

### 2.4 用户交互

| 操作 | 行为 |
|------|------|
| 点击左/右箭头 | 切换到上/下个月 |
| 点击某一天 | 选中该天，下方显示该天的任务详情 |
| 点击下方任务项 | 切换该任务的完成状态（已完成 ↔ 未完成） |

- ✅ 可以编辑任意历史日期的记录
- ✅ 随时可以自由修改

---

## 3. 技术架构

### 3.1 数据存储

```
Vercel Blob Storage
        ↓
    data.json  ← 所有打卡记录
```

本地开发可不配置 `BLOB_READ_WRITE_TOKEN`，将数据暂存到项目根目录 `.local-data.json`（仅用于开发环境）。

**数据结构示例：**
```json
{
  "records": {
    "2025-01-15": {
      "earlyWake": true,
      "earlySleep": false,
      "takeout": true,
      "eatOut": false
    },
    "2025-01-16": {
      "earlyWake": true,
      "earlySleep": true,
      "takeout": false,
      "eatOut": false
    }
  }
}
```

### 3.2 认证机制

| 项目 | 说明 |
|------|------|
| 方式 | 单一密码保护 |
| 密码存储 | `.env` 文件（`PASSWORD=xxx`） |
| 登录状态 | Cookie 永久保持 |
| 验证流程 | 首次访问 → 弹出密码输入框 → 验证通过 → 设置 Cookie → 正常使用 |

### 3.3 环境变量

```env
# .env.local (添加到 .gitignore)
PASSWORD=your_password_here
BLOB_READ_WRITE_TOKEN=your_vercel_blob_token
```

### 3.4 API 设计

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/auth` | POST | 验证密码 |
| `/api/records` | GET | 获取指定月份的记录 |
| `/api/records` | POST | 更新某天的任务状态 |

---

## 4. UI/UX 设计规范

### 4.1 设计风格

- **整体风格**：可爱、简洁、现代
- **配色**：
  - 正向任务图标：柔和的薄荷绿 `#6BCB77`
  - 负向任务图标：柔和的珊瑚红 `#FF6B6B`
  - 当天日期标记：红色 `bg-red-500`
  - 使用柔和、温暖的色调，避免过于鲜艳刺眼
- **图标库**：使用 `lucide-react` 提供语义化图标
  - 任务列表显示大尺寸 Lucide 线条图标（32px），使用 `strokeWidth={3}` 加粗
  - 完成状态显示白色 `Check` 图标在彩色圆形背景上
  - 日历格子四角显示小尺寸彩色 Lucide 图标（12px，`strokeWidth={2.5}`）
  - 图标直接使用 `style={{ color }}` 设置颜色，简洁清晰
- **圆角**：大圆角设计，增加亲和力
- **动效**：适当的过渡动画，点击有反馈

### 4.2 主题支持

| 模式 | 背景 | 文字 | 卡片 |
|------|------|------|------|
| 浅色 | 温暖米白 | 深灰 | 白色 |
| 深色 | 深蓝灰 | 浅灰 | 深灰 |

- 自动跟随系统主题切换

### 4.3 响应式

- 仅优化移动端竖屏体验
- 建议视口宽度：320px - 428px
- 桌面端访问时居中显示，最大宽度 428px

---

## 5. 项目结构

```
tutudaka/
├── app/
│   ├── api/
│   │   ├── auth/
│   │   │   └── route.ts        # 密码验证
│   │   └── records/
│   │       └── route.ts        # 记录 CRUD
│   ├── components/
│   │   ├── Calendar.tsx        # 月历组件
│   │   ├── DayCell.tsx         # 日期格子组件
│   │   ├── TaskList.tsx        # 任务清单组件
│   │   ├── TaskItem.tsx        # 单个任务组件
│   │   ├── PasswordModal.tsx   # 密码输入弹窗
│   │   └── Header.tsx          # 顶部月份切换
│   ├── hooks/
│   │   └── useRecords.ts       # 数据获取 Hook
│   ├── lib/
│   │   ├── blob.ts             # Vercel Blob 操作
│   │   └── auth.ts             # 认证相关
│   ├── types/
│   │   └── index.ts            # TypeScript 类型定义
│   ├── globals.css
│   ├── layout.tsx
│   └── page.tsx
├── .env.local                  # 环境变量（不提交）
├── .gitignore
├── package.json
└── README.md
```

---

## 6. 开发计划

### Phase 1: 基础框架 🏗️
- [x] 项目初始化
- [x] 环境变量配置
- [x] 基础布局搭建

### Phase 2: 核心功能 ⚙️
- [x] 月历视图组件
- [x] 任务清单组件
- [x] 日期选择交互
- [x] 任务状态切换

### Phase 3: 数据层 💾
- [x] Vercel Blob 集成
- [x] API 路由开发
- [x] 数据读写逻辑

### Phase 4: 安全 & 认证 🔐
- [x] 密码验证 API
- [x] 密码输入弹窗
- [x] Cookie 持久化

### Phase 5: 美化 & 优化 ✨
- [x] 明暗主题适配
- [x] 动效优化
- [x] 移动端体验优化

> 进度：Phase 1-8 已完成（UI、数据层、认证、主题全部就绪），待完成 Phase 9 的测试与部署。

---

## 7. 非功能需求

| 类别 | 要求 |
|------|------|
| 性能 | 首屏加载 < 2s |
| 兼容性 | iOS Safari, Android Chrome |
| 可访问性 | 基础无障碍支持 |
| 安全性 | 密码 HTTP-only Cookie |

---

## 8. 未来可能的扩展（暂不实现）

- 📊 统计功能（周/月完成率、连续打卡）
- 🔔 提醒功能
- 📱 PWA 离线支持
- 👥 多用户支持
- 🎨 自定义任务和颜色

---

## 9. 详细开发任务清单 📋

### Task 1: 项目配置与基础设施 🏗️

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 1.1 | 配置 .gitignore | 添加 `.env.local` 到 .gitignore | 5min |
| 1.2 | 创建 .env.local 模板 | 创建 `.env.example` 作为模板参考 | 5min |
| 1.3 | 安装依赖 | 安装 `@vercel/blob` 和 `lucide-react` 包 | 5min |
| 1.4 | 创建类型定义 | `app/types/index.ts` - 定义 DayRecord, TaskType 等类型 | 15min |
| 1.5 | 配置 CSS 变量 | `globals.css` - 定义颜色、间距、圆角等设计 token | 20min |

---

### Task 2: 认证系统 🔐

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 2.1 | 创建认证 API | `app/api/auth/route.ts` - POST 验证密码 | 20min |
| 2.2 | 创建认证检查 API | `app/api/auth/check/route.ts` - GET 检查登录状态 | 15min |
| 2.3 | 创建认证工具函数 | `app/lib/auth.ts` - Cookie 操作、验证逻辑 | 20min |
| 2.4 | 密码输入弹窗组件 | `app/components/PasswordModal.tsx` - UI + 验证逻辑 | 30min |
| 2.5 | 集成认证到主页 | `app/page.tsx` - 检查登录状态，未登录显示弹窗 | 20min |

---

### Task 3: 数据存储层 💾

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 3.1 | Blob 工具函数 | `app/lib/blob.ts` - 读取/写入 Vercel Blob | 30min |
| 3.2 | 获取记录 API | `app/api/records/route.ts` GET - 返回所有记录 | 20min |
| 3.3 | 更新记录 API | `app/api/records/route.ts` POST - 更新指定日期任务 | 25min |
| 3.4 | 数据获取 Hook | `app/hooks/useRecords.ts` - 封装数据获取和更新逻辑 | 30min |

---

### Task 4: UI 组件 - 头部 📅

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 4.1 | Header 组件结构 | `app/components/Header.tsx` - 基础 JSX 结构 | 15min |
| 4.2 | 月份显示 | 显示 "2025年1月" 格式 | 10min |
| 4.3 | 左右箭头按钮 | 上/下月切换按钮 + 点击事件 | 15min |
| 4.4 | Header 样式 | 居中布局、箭头样式、过渡动画 | 20min |

---

### Task 5: UI 组件 - 月历视图 📆

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 5.1 | Calendar 组件结构 | `app/components/Calendar.tsx` - 基础 JSX 结构 | 15min |
| 5.2 | 星期标题行 | 显示 "日 一 二 三 四 五 六" | 10min |
| 5.3 | 日期网格生成 | 计算当月天数、起始星期、生成格子数组 | 25min |
| 5.4 | DayCell 组件 | `app/components/DayCell.tsx` - 单个日期格子 | 20min |
| 5.5 | 四角彩色图标渲染 | 根据任务完成情况显示/隐藏彩色 Lucide 图标 | 25min |
| 5.6 | 当天高亮样式 | 今天日期 24px 红色圆形背景 | 10min |
| 5.7 | 选中态样式 | 被点击选中的日期样式 | 10min |
| 5.8 | 点击选择日期 | 点击日期 → 更新 selectedDate 状态 | 15min |
| 5.9 | 月份切换动画 | 左右滑动过渡效果 | 20min |

---

### Task 6: UI 组件 - 任务清单 ✅

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 6.1 | TaskList 组件结构 | `app/components/TaskList.tsx` - 基础 JSX 结构 | 15min |
| 6.2 | TaskItem 组件 | `app/components/TaskItem.tsx` - 单个任务项 | 20min |
| 6.3 | 任务状态显示 | emoji + 名称 + 勾选状态 | 15min |
| 6.4 | 点击切换状态 | 点击任务项 → 调用 API 更新 → 刷新显示 | 25min |
| 6.5 | 任务列表样式 | 2x2 网格布局、卡片样式、间距 | 20min |
| 6.6 | 点击反馈动效 | 点击时的缩放/颜色过渡动画 | 15min |

---

### Task 7: 主页面集成 🏠

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 7.1 | 页面状态管理 | currentMonth, selectedDate, records 状态 | 20min |
| 7.2 | 组装布局 | Header + Calendar + TaskList 垂直排列 | 15min |
| 7.3 | 数据流串联 | selectedDate → TaskList 显示对应日期数据 | 20min |
| 7.4 | 月份切换逻辑 | 箭头点击 → 更新 currentMonth → 重新获取数据 | 15min |
| 7.5 | 加载状态 | 数据加载中显示 loading 骨架屏 | 20min |
| 7.6 | 错误处理 | API 失败时显示友好提示 | 15min |

---

### Task 8: 主题与样式 🎨

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 8.1 | 浅色主题变量 | 定义浅色模式下的所有颜色 | 20min |
| 8.2 | 深色主题变量 | 使用 `@media (prefers-color-scheme: dark)` | 20min |
| 8.3 | 可爱绿色圆点 | 正向任务圆点颜色 (#6BCB77 或类似) | 10min |
| 8.4 | 可爱红色圆点 | 负向任务圆点颜色 (#FF6B6B 或类似) | 10min |
| 8.5 | 全局字体 | 选择合适的中文友好字体 | 10min |
| 8.6 | 圆角统一 | 所有卡片、按钮使用一致的大圆角 | 10min |
| 8.7 | 移动端适配 | max-width: 428px 居中、安全区域适配 | 20min |

---

### Task 9: 测试与部署 🚀

| # | 子任务 | 描述 | 预计时间 |
|---|--------|------|----------|
| 9.1 | 本地测试 | 完整功能流程测试 | 30min |
| 9.2 | 配置 Vercel 环境变量 | 在 Vercel 控制台添加 PASSWORD 和 BLOB_TOKEN | 10min |
| 9.3 | 部署到 Vercel | 推送代码触发自动部署 | 15min |
| 9.4 | 生产环境测试 | 在真实手机上测试完整流程 | 30min |
| 9.5 | Bug 修复 | 修复发现的问题 | TBD |

---

## 📊 任务统计

| 阶段 | 任务数 | 预计总时间 |
|------|--------|------------|
| Task 1: 项目配置 | 5 | ~50min |
| Task 2: 认证系统 | 5 | ~105min |
| Task 3: 数据存储 | 4 | ~105min |
| Task 4: Header | 4 | ~60min |
| Task 5: 月历视图 | 9 | ~150min |
| Task 6: 任务清单 | 6 | ~110min |
| Task 7: 主页集成 | 6 | ~105min |
| Task 8: 主题样式 | 7 | ~100min |
| Task 9: 测试部署 | 5 | ~85min |
| **合计** | **51** | **~14.5h** |

---

## 🎯 推荐开发顺序

```
1️⃣ Task 1 (配置) 
    ↓
2️⃣ Task 4 + 5 (Header + Calendar) - 先做 UI 骨架
    ↓
3️⃣ Task 6 (TaskList) - 完成静态 UI
    ↓
4️⃣ Task 7 (主页集成) - 用 mock 数据跑通交互
    ↓
5️⃣ Task 3 (数据层) - 接入真实存储
    ↓
6️⃣ Task 2 (认证) - 加上密码保护
    ↓
7️⃣ Task 8 (美化) - 主题和细节优化
    ↓
8️⃣ Task 9 (部署) - 上线！
```
